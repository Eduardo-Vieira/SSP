<?xml version="1.0" encoding="UTF-8"?>
<!--

    Licensed to Jasig under one or more contributor license
    agreements. See the NOTICE file distributed with this work
    for additional information regarding copyright ownership.
    Jasig licenses this file to you under the Apache License,
    Version 2.0 (the "License"); you may not use this file
    except in compliance with the License. You may obtain a
    copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on
    an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied. See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="nvarchar.type" value="character varying" dbms="postgresql" />
	<property name="nvarchar.type" value="nvarchar" dbms="mssql" />

	<changeSet author='daniel.bower' id='Implement ChallengeCategory'>
		<dropColumn tableName="challenge_category" columnName="name" />
		<dropColumn tableName="challenge_category" columnName="description" />

		<addColumn tableName="challenge_category">
			<column name="challenge_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="challenge_category_challenge_id_challenge_id"
					references="challenge(id)" />
			</column>
			<column name="category_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="challenge_category_category_id_category_id"
					references="category(id)" />
			</column>
		</addColumn>

		<rollback>
			<addColumn tableName="challenge_category">
				<column name="name" type="${nvarchar.type}(80)" value="default">
					<constraints nullable="false" />
				</column>
				<column name="description" type="text">
					<constraints nullable="true" />
				</column>
			</addColumn>
			<dropColumn tableName="challenge_category" columnName="challenge_id" />
			<dropColumn tableName="challenge_category" columnName="category_id" />
		</rollback>
	</changeSet>

	<changeSet author="daniel.bower" id="add person to goal">
		<addColumn tableName="goal">
			<column name="person_id" type="uuid">
				<constraints nullable="false" foreignKeyName="goal_person_id_person_id"
					references="person(id)" />
			</column>
		</addColumn>

		<rollback>
			<dropColumn tableName="goal" columnName="person_id" />
		</rollback>
	</changeSet>

	<changeSet author='daniel.bower' id='Add special_service_group table'>
		<createTable tableName="special_service_group">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="special_service_group_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="special_service_group_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on special_service_group to ssp</sql>
		<rollback>
			<dropTable tableName="special_service_group" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='daniel.bower' id='Add service_reason table'>
		<createTable tableName="service_reason">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="service_reason_created_by_person_id" references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="service_reason_modified_by_person_id" references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on service_reason to ssp</sql>
		<rollback>
			<dropTable tableName="service_reason" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='daniel.bower' id='Add referral_source table'>
		<createTable tableName="referral_source">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="referral_source_created_by_person_id" references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="referral_source_modified_by_person_id" references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on referral_source to ssp</sql>
		<rollback>
			<dropTable tableName="referral_source" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="Add defaultValue to Config" author="daniel.bower">
		<addColumn tableName="config">
			<column name="default_value" type="text">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<!-- add initial values here -->
		<update tableName="config">
			<column name="value" value="noone@test.com" />
			<column name="default_value" value="noone@test.com" />
			<where>id='59dbcf48-9be3-11e1-bded-0026b9e7ff4c'</where>
		</update>
		<update tableName="config">
			<column name="value" value="3" />
			<column name="default_value" value="3" />
			<where>id='645d19ea-9be3-11e1-8ffe-0026b9e7ff4c'</where>
		</update>
		<update tableName="config">
			<column name="default_value" value="SSP" />
			<where>id='67bd120e-9be1-11e1-ad1f-0026b9e7ff4c'</where>
		</update>
		<update tableName="config">
			<column name="value" value="http://test.edu" />
			<column name="default_value" value="http://test.edu" />
			<where>id='8298fc28-9be1-11e1-933d-0026b9e7ff4c'</where>
		</update>
		<update tableName="config">
			<column name="value" value="http://ssp.test.edu" />
			<column name="default_value" value="http://ssp.test.edu" />
			<where>id='e6c63bb0-9be2-11e1-a6cb-0026b9e7ff4c'</where>
		</update>
		<update tableName="config">
			<column name="value" value="My Edu" />
			<column name="default_value" value="My Edu" />
			<where>id='e99ff3c7-6a59-4812-b3b1-285fa8764d3a'</where>
		</update>
		<update tableName="config">
			<column name="default_value" value="Early Alert" />
			<where>id='80e51b59-3936-436a-93e2-9a116c1fd03c'</where>
		</update>

		<addNotNullConstraint tableName="config"
			columnName="default_value" columnDataType="text" />

		<rollback>
			<dropColumn tableName="config" columnName="default_value" />
		</rollback>
	</changeSet>

	<changeSet id="Test mail server port" author="daniel.bower">
		<insert tableName="config">
			<column name="id" value="43bd3066-a5a8-11e1-8e16-0026b9e7ff4c" />
			<column name="name" value="test_env_mock_mail_server_port" />
			<column name="description"
				value="The port to start the mock mail server on in the test environment" />
			<column name="value">40025</column>
			<column name="default_value">40025</column>
			<column name="created_date" valueDate="2012-05-07T12:00:00" />
			<column name="modified_date" valueDate="2012-05-07T12:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="sort_order" value="100" />
		</insert>
		<insert tableName="config">
			<column name="id" value="3eb8d2ee-9baa-11e1-844c-0026b9e7ff4c" />
			<column name="name" value="send_mail" />
			<column name="description"
				value="Whether the system should send out mails, or just log their generation" />
			<column name="value">false</column>
			<column name="default_value">false</column>
			<column name="created_date" valueDate="2012-05-07T12:00:00" />
			<column name="modified_date" valueDate="2012-05-07T12:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="sort_order" value="100" />
		</insert>

		<rollback>
			<delete tableName="config">
				<where>id='43bd3066-a5a8-11e1-8e16-0026b9e7ff4c'</where>
			</delete>
			<delete tableName="config">
				<where>id='3eb8d2ee-9baa-11e1-844c-0026b9e7ff4c'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet author='jon.adams' id='Add early_alert_routing table'>
		<createTable tableName="early_alert_routing">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="early_alert_routing_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="early_alert_routing_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="campus_id" type="uuid">
				<constraints nullable="false" foreignKeyName="early_alert_routing_campus_id"
					references="campus(id)" />
			</column>
			<column name="early_alert_reason_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="early_alert_routing_early_alert_reason_id"
					references="early_alert_reason(id)" />
			</column>
			<column name="person_id" type="uuid">
				<constraints nullable="true" foreignKeyName="early_alert_routing_person_id"
					references="person(id)" />
			</column>
			<column name="group_name" type="${nvarchar.type}(255)" />
			<column name="group_email" type="${nvarchar.type}(255)" />
		</createTable>

		<sql>grant all on early_alert_routing to ssp</sql>
		<rollback>
			<dropTable tableName="early_alert_routing" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='daniel.bower' id='Add person_special_service_group table'>
		<createTable tableName="person_special_service_group">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_special_service_group_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_special_service_group_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="person_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_special_service_group_person_id_person_id"
					references="person(id)" />
			</column>
			<column name="special_service_group_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_special_service_group_special_service_group_id_special_service_group_id"
					references="special_service_group(id)" />
			</column>
		</createTable>

		<sql>grant all on person_special_service_group to ssp</sql>
		<rollback>
			<dropTable tableName="person_special_service_group" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='daniel.bower' id='Add person_service_reason table'>
		<createTable tableName="person_service_reason">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_service_reason_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_service_reason_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="person_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_service_reason_person_id_person_id"
					references="person(id)" />
			</column>
			<column name="service_reason_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_service_reason_service_reason_id_service_reason_id"
					references="service_reason(id)" />
			</column>
		</createTable>

		<sql>grant all on person_service_reason to ssp</sql>
		<rollback>
			<dropTable tableName="person_service_reason" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='daniel.bower' id='Add person_referral_source table'>
		<createTable tableName="person_referral_source">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_referral_source_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_referral_source_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="person_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_referral_source_person_id_person_id"
					references="person(id)" />
			</column>
			<column name="referral_source_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_referral_source_referral_source_id_referral_source_id"
					references="referral_source(id)" />
			</column>
		</createTable>

		<sql>grant all on person_referral_source to ssp</sql>
		<rollback>
			<dropTable tableName="person_referral_source" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="add properties to Person" author="daniel.bower">
		<addColumn tableName="person">
			<column name="ability_to_benefit" type="boolean">
				<constraints nullable="true" />
			</column>
			<column name="anticipated_start_term" type="${nvarchar.type}(20)">
				<constraints nullable="true" />
			</column>
			<column name="anticipated_start_year" type="int">
				<constraints nullable="true" />
			</column>
			<column name="student_intake_request_date" type="datetime">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<rollback>
			<dropColumn tableName="person" columnName="ability_to_benefit" />
			<dropColumn tableName="person" columnName="anticipated_start_year" />
			<dropColumn tableName="person" columnName="anticipated_start_term" />
			<dropColumn tableName="person" columnName="student_intake_request_date" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet author='jon.adams' id='Add program_status_change_reason table'>
		<createTable tableName="program_status_change_reason">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="program_status_change_reason_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="program_status_change_reason_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on program_status_change_reason to ssp</sql>
		<rollback>
			<dropTable tableName="program_status_change_reason" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="create reference data - program_status_change_reason"
		author="jon.adams">
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D1271B-5056-A51A-8018-F5ED8477B481" />
			<column name="name" value="Financially unable to purchase books" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D12798-5056-A51A-8072-DA587A14081F" />
			<column name="name" value="Financially unable to pay for tuition" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D127B7-5056-A51A-8084-E0468053CC30" />
			<column name="name" value="Childcare issues" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D127D7-5056-A51A-802D-3717C4316D29" />
			<column name="name" value="Transportation issues" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D12844-5056-A51A-80C7-7059B24CCBCE" />
			<column name="name" value="Personal issues" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D12863-5056-A51A-808A-1241D680A42F" />
			<column name="name" value="Medical issues" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D12873-5056-A51A-805C-99222DEFC6D5" />
			<column name="name" value="Transferred to another school" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D12883-5056-A51A-80A8-BB4616AF9BD0" />
			<column name="name" value="Services not needed" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D128F0-5056-A51A-803F-8CEF57177AEA" />
			<column name="name" value="Moving" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D1290F-5056-A51A-8094-3B321A901899" />
			<column name="name" value="Unknown/unable to contact" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D1295D-5056-A51A-80BB-3094BAB8F9C4" />
			<column name="name" value="Military Service" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D1299C-5056-A51A-8052-7E123C180661" />
			<column name="name" value="Death" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D129BB-5056-A51A-8082-5E6613AD6F5D" />
			<column name="name" value="Employment interferes with school" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="program_status_change_reason">
			<column name="id" value="B2D129CB-5056-A51A-8035-FF5834C72153" />
			<column name="name" value="Poor academic performance (Dropout)" />
			<column name="description" value="Default description" />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<rollback>
			<delete tableName="program_status_change_reason">
				<where>id='B2D1271B-5056-A51A-8018-F5ED8477B481'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D12798-5056-A51A-8072-DA587A14081F'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D127B7-5056-A51A-8084-E0468053CC30'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D127D7-5056-A51A-802D-3717C4316D29'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D12844-5056-A51A-80C7-7059B24CCBCE'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D12863-5056-A51A-808A-1241D680A42F'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D12873-5056-A51A-805C-99222DEFC6D5'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D12883-5056-A51A-80A8-BB4616AF9BD0'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D128F0-5056-A51A-803F-8CEF57177AEA'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D1290F-5056-A51A-8094-3B321A901899'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D1295D-5056-A51A-80BB-3094BAB8F9C4'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D1299C-5056-A51A-8052-7E123C180661'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D129BB-5056-A51A-8082-5E6613AD6F5D'</where>
			</delete>
			<delete tableName="program_status_change_reason">
				<where>id='B2D129CB-5056-A51A-8035-FF5834C72153'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet author='jon.adams' id='Add student_type table'>
		<createTable tableName="student_type">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="student_type_created_by_person_id" references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="student_type_modified_by_person_id" references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="require_initial_appointment" type="boolean"
				defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on student_type to ssp</sql>
		<rollback>
			<dropTable tableName="student_type" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="create reference data - student_type" author="jon.adams">
		<insert tableName="student_type">
			<column name="id" value="B2D058EB-5056-A51A-80A7-8A20C30D1E91" />
			<column name="name" value="ILP" />
			<column name="description" value="A new student." />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="require_initial_appointment" value="1" />
		</insert>
		<insert tableName="student_type">
			<column name="id" value="B2D05919-5056-A51A-80BD-03E5288DE771" />
			<column name="name" value="CAP" />
			<column name="description"
				value="A returning student with more than 1 credit hour at the institution." />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="require_initial_appointment" value="1" />
		</insert>
		<insert tableName="student_type">
			<column name="id" value="B2D05939-5056-A51A-8004-D803265D2645" />
			<column name="name" value="EAL" />
			<column name="description" value="An Early Alert student." />
			<column name="created_date" valueDate="2012-28-18T14:00:00" />
			<column name="modified_date" valueDate="2012-28-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="require_initial_appointment" value="0" />
		</insert>
		<rollback>
			<delete tableName="student_type">
				<where>id='B2D058EB-5056-A51A-80A7-8A20C30D1E91'</where>
			</delete>
			<delete tableName="student_type">
				<where>id='B2D05919-5056-A51A-80BD-03E5288DE771'</where>
			</delete>
			<delete tableName="student_type">
				<where>id='B2D05939-5056-A51A-8004-D803265D2645'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet id="Add student type to person" author="daniel.bower">
		<addColumn tableName="person">
			<column name="student_type_id" type="uuid">
				<constraints nullable="true"
					foreignKeyName="person_student_type_id_student_type_id" references="student_type(id)" />
			</column>
		</addColumn>
		<rollback>
			<dropColumn tableName="person" columnName="student_type" />
		</rollback>
	</changeSet>

	<changeSet id="drop JournalEntryJournalStepDetail table"
		author="daniel.bower">
		<dropTable tableName="journal_entry_journal_step_detail" />
		<rollback>
			<createTable tableName="journal_entry_journal_step_detail">
				<column name="id" type="uuid">
					<constraints primaryKey="true" nullable="false" />
				</column>
				<column name="created_date" type="datetime">
					<constraints nullable="false" />
				</column>
				<column name="modified_date" type="datetime">
					<constraints nullable="false" />
				</column>
				<column name="created_by" type="uuid">
					<constraints nullable="false"
						foreignKeyName="journal_entry_journal_step_detail_created_by_person_id"
						references="person(id)" />
				</column>
				<column name="modified_by" type="uuid">
					<constraints nullable="false"
						foreignKeyName="journal_entry_journal_step_detail_modified_by_person_id"
						references="person(id)" />
				</column>
				<column name="object_status" type="int">
					<constraints nullable="false" />
				</column>
				<column name="journal_entry_id" type="uuid">
					<constraints nullable="false"
						foreignKeyName="journal_entry_journal_step_detail_journal_entry_id_journal_entry_id"
						references="journal_entry(id)" />
				</column>
				<column name="journal_step_detail_id" type="uuid">
					<constraints nullable="false"
						foreignKeyName="journal_entry_journal_step_detail_journal_step_detail_id_journal_step_detail_id"
						references="journal_step_detail(id)" />
				</column>
			</createTable>

			<sql>grant all on journal_entry_journal_step_detail to ssp</sql>
		</rollback>


		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>
	</changeSet>

	<changeSet id="add JouralEntryDetail table" author="daniel.bower">
		<createTable tableName="journal_entry_detail">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="journal_entry_detail_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="journal_entry_detail_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="journal_entry_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="journal_entry_detail_journal_entry_id_journal_entry_id"
					references="journal_entry(id)" />
			</column>
			<column name="journal_step_journal_step_detail_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="journal_entry_detail_journal_step_journal_step_detail_id_journal_step_journal_step_detail_id"
					references="journal_step_journal_step_detail(id)" />
			</column>
		</createTable>

		<sql>grant all on journal_entry_detail to ssp</sql>
		<rollback>
			<dropTable tableName="journal_entry_detail" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="Add Legacy MessageTemplates" author="daniel.bower">
		<insert tableName="message_template">
			<column name="id" value="0B7E484D-44E4-4F0D-8DB5-3518D015B495" />
			<column name="name" value="Contact Coach Email" />
			<column name="description" value="Contact Coach Email" />
			<column name="subject" value="A Message from Your Advisee" />
			<column name="body" value="EMPTY" />
			<column name="created_date" valueDate="2012-05-17T10:00:00" />
			<column name="modified_date" valueDate="2012-05-17T10:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>

		<insert tableName="message_template">
			<column name="id" value="5D183F35-023D-40EA-B8D9-66FBE190FFFB" />
			<column name="name" value="Action Plan Email" />
			<column name="description" value="Action Plan Email" />
			<column name="subject" value="Action plan for $(fullName)" />
			<column name="body" value="EMPTY" />
			<column name="created_date" valueDate="2012-05-17T10:00:00" />
			<column name="modified_date" valueDate="2012-05-17T10:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="message_template">
			<column name="id" value="9D3CE5B1-E27D-40C8-8F45-ABCB1BCCF3B0" />
			<column name="name" value="New Student Intake Task Email" />
			<column name="description" value="New Student Intake Task Email" />
			<column name="subject" value="Student Intake Form Request" />
			<column name="body" value="EMPTY" />
			<column name="created_date" valueDate="2012-05-17T10:00:00" />
			<column name="modified_date" valueDate="2012-05-17T10:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>

		<sql>
<![CDATA[
update message_template
set body = 'From: ${fullName} <br/> Subject: ${subject} <br/><br/>${message}'
where id = '0B7E484D-44E4-4F0D-8DB5-3518D015B495';

update message_template
set body = '<html><body>Dear ${fullName},<br/><br/>As a result of completing the self help guide questionnaire(s) you have identified the following resource information as being imperative to your success.&nbsp;&nbsp;Below you will find the solutions you felt offered the best path to your success.<br/><br/><br/>#foreach($taskTO in $taskTOs)<b>Resource:</b>&nbsp;${taskTO.name}<br/><b>Description:</b>&nbsp;${taskTO.description}<br/><br/>#end <br/>Should you have any questions concerning the resource information listed please contact the resource in question or the counseling staff at your institution.<br/><br/>Thank you.</body></html>'
where id = '5D183F35-023D-40EA-B8D9-66FBE190FFFB';

update message_template
set body = '<html><body><p>Hello ${fullName}!</p><p>Your Coach or Advisor has asked that you complete a Task online, the Student Intake form.  ${description}  The form is a series of questions that should only take a few minutes to complete.  The information collected will assist us in providing you with the best services and advice that we can.</p> <p>Please login with your college username and password at the following URL:  <a href="https://resources.sinclair.edu">https://resources.sinclair.edu</a></p><p>The Student Intake link will appear in the Task list on the right side of the screen.</p><p>Please complete this task by ${dueDate}</p><p>Thank you for your time and cooperation.  We look forward to providing you great service!</p><p>-Sinclair Team</p><p>If you have questions, please contact your Coach or Advisor directly. This is an automated message, please do not use the reply option.</p></body></html>'
where id = '9D3CE5B1-E27D-40C8-8F45-ABCB1BCCF3B0';
]]>
		</sql>

		<rollback>
			<delete tableName="message_template">
				<where>id = '0B7E484D-44E4-4F0D-8DB5-3518D015B495'</where>
			</delete>

			<delete tableName="message_template">
				<where>id = '5D183F35-023D-40EA-B8D9-66FBE190FFFB'</where>
			</delete>

			<delete tableName="message_template">
				<where>id = '9D3CE5B1-E27D-40C8-8F45-ABCB1BCCF3B0'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet id="Additional Legacy MessageTemplates" author="daniel.bower">
		<insert tableName="message_template">
			<column name="id" value="AEC07252-1FF0-479D-A2EF-C0E017E1C05D" />
			<column name="name" value="Action Plan Step Email" />
			<column name="description" value="Action Plan Step Email" />
			<column name="subject" value="An Action Item is Due for Review" />
			<column name="body" value="EMPTY" />
			<column name="created_date" valueDate="2012-05-17T10:00:00" />
			<column name="modified_date" valueDate="2012-05-17T10:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>
		<insert tableName="message_template">
			<column name="id" value="31CF8D8D-2BC9-44E0-AAD1-D8BA43530BB0" />
			<column name="name" value="Custom Action Plan Task Email" />
			<column name="description" value="Custom Action Plan Task Email" />
			<column name="subject" value="An Action Item is Due for Review" />
			<column name="body" value="EMPTY" />
			<column name="created_date" valueDate="2012-05-17T10:00:00" />
			<column name="modified_date" valueDate="2012-05-17T10:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
		</insert>

		<sql>
<![CDATA[
update message_template
set body = '${task.person.firstName},<br/>An Action Item identified through the Sinclair Community College Resources application needs your attention.  Please login to your account at https://resources.sinclair.edu to review and complete the assigned item.<br/><br/>The following item is due for review:<br/>Challenge: ${task.challengeName}<br/>Referral: ${task.challengeReferralName}<br/>Due Date: ${task.dueDateFormatted}'
where id = 'AEC07252-1FF0-479D-A2EF-C0E017E1C05D';

update message_template
set body = '${task.person.firstName},<br/>An Action Item identified through the Sinclair Community College Resources application needs your attention.  Please login to your account at https://resources.sinclair.edu to review and complete the assigned item.<br/><br/>The following item is due for review:<br/>Name: ${task.name}<br/>Description: ${task.description}<br/>Due Date: ${task.dueDateFormatted}'
where id = '31CF8D8D-2BC9-44E0-AAD1-D8BA43530BB0';
]]>
		</sql>

		<rollback>
			<delete tableName="message_template">
				<where>id = 'AEC07252-1FF0-479D-A2EF-C0E017E1C05D'</where>
			</delete>

			<delete tableName="message_template">
				<where>id = '31CF8D8D-2BC9-44E0-AAD1-D8BA43530BB0'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet id="Add CC to Message" author="daniel.bower">
		<addColumn tableName="message">
			<column name="carbon_copy" type="${nvarchar.type}(512)">
				<constraints nullable="true" />
			</column>
		</addColumn>
		<rollback>
			<dropColumn tableName="message" columnName="carbon_copy" />
		</rollback>
	</changeSet>

	<changeSet id="Convert Early Alert Templates to HTML" author="daniel.bower">
		<sql>
			<![CDATA[
			update message_template
			set body = '<html><body>
<p><b>$!termToRepresentEarlyAlert DETAILS</b></p>

<table>
<tr><th>Faculty Member</th><td>$earlyAlert.createdBy.fullName</td></tr>
<tr><th>Faculty Office Location</th><td>$!earlyAlert.createdBy.officeLocation</td></tr>
<tr><th>Faculty Phone Number</th><td>$!earlyAlert.createdBy.workPhone</td></tr>
<tr><th>Course</th><td>$!earlyAlert.courseName</td></tr>
<tr><th>Title</th><td>$!earlyAlert.courseTitle</td></tr>
</table>

<p><b>Referral Reasons:</b></p>
<ul>
#foreach( $earlyAlertReferral in $earlyAlertResponse.earlyAlertReferralIds )
<li> $earlyAlertReferral.name </li>
#end
</ul>

<p><b>Faculty suggestions:</b></p>
<ul>
#foreach( $earlyAlertSuggestion in $earlyAlert.earlyAlertSuggestionIds )
<li> $earlyAlertSuggestion.name </li>
#end
</ul>

#if( $earlyAlert.comment )
<p>******************* INSTRUCTOR COMMENTS *******************
<br />
$earlyAlert.comment
<br />
******************* INSTRUCTOR COMMENTS *******************
</p>
#end

<p>Email generated by $!institutionName $!applicationTitle $!termToRepresentEarlyAlert</p>
</body></html>'
where id = 'b528c1ac-6104-435b-ae62-08eb4f7ee2f9';

update message_template
set body = '<html><body>
<p><b>STUDENT $!termToRepresentEarlyAlert SYSTEM MESSAGE</b></p>

<table>
<tr><th>Student Name</th><td>$earlyAlert.person.firstName $earlyAlert.person.lastName</td></tr>
<tr><th>Student ID</th><td>$!earlyAlert.person.schoolId</td></tr>
<tr><th>Student Phone</th><td>$!earlyAlert.person.homePhone</td></tr>
<tr><th>Student Email</th><td>$earlyAlert.person.primaryEmailAddress</td></tr>
<tr><th>Address</th><td>#if( $earlyAlert.person.addressLine1 )$earlyAlert.person.addressLine1, #end#if( $earlyAlert.person.addressLine2 )$earlyAlert.person.addressLine2, #end#if( $earlyAlert.person.city )$earlyAlert.person.city, #end#if( $earlyAlert.person.state )$earlyAlert.person.state, #end$!earlyAlert.person.zipCode</td></tr>
<tr><th>In the class</th><td>$!earlyAlert.courseName</td></tr>
<tr><th>Instructor</th><td>$earlyAlert.createdBy.firstName $earlyAlert.createdBy.lastName</td></tr>
<tr><th>Campus</th><td>$earlyAlert.campus.name</td></tr>
<tr><th>Instructor Office Location</th><td>$!earlyAlert.createdBy.officeLocation</td></tr>
<tr><th>Instructor Email</th><td>$earlyAlert.createdBy.primaryEmailAddress</td></tr>
<tr><th>Instructor Phone</th><td>$!earlyAlert.createdBy.workPhone</td></tr>
<tr><th>Advisor</th><td>$earlyAlert.person.coach.firstName $earlyAlert.person.coach.lastName</td></tr>
</table>

<p><b>Student has been identified by his/her instructor for the following reason:</b></p>
<ul>
#foreach( $earlyAlertReason in $earlyAlert.earlyAlertReasonIds )
<li>$earlyAlertReason.name</li>
#end
</ul>

<p><b>The faculty suggestions are:</b></p>
<ul>
#foreach( $earlyAlertSuggestion in $earlyAlert.earlyAlertSuggestionIds )
<li>$earlyAlertSuggestion.name</li>
#end
</ul>

#if( $earlyAlert.comment )
<p>
******************* INSTRUCTOR COMMENTS *******************
<br />
$earlyAlert.comment
<br />
******************* INSTRUCTOR COMMENTS *******************
<p>
#end

<p>To access additional information or respond to this alert, log-in#if( $applicationTitle ) to $applicationTitle#end#if( $termForEarlyAlert ) and view the student&apos;s $termForEarlyAlert Tool#end.  $!linkToSSP </p>

<p>Email generated by $!applicationTitle $!termForEarlyAlert</p>
</body></html>'
where id = 'b528c1ac-6104-435b-ae62-08eb4f7ee3fc';

update message_template
set body = '<html><body>
<p>Dear $earlyAlert.person.firstName $earlyAlert.person.lastName</p>

<p>Your instructor for #if( $earlyAlert.courseName )$earlyAlert.courseName#else<COURSE NAME UNAVAILABLE>#end notified me that you are experiencing issues that might affect your success#if( $institutionName ) at $institutionName#end.  An academic advisor, counselor or coach will contact you soon to discuss your situation. In the meantime, here are a few resources which may help you find academic success.</p>

<table><tr><th>Instructor</th><td>$earlyAlert.createdBy.firstName $earlyAlert.createdBy.lastName#if( $earlyAlert.createdBy.workPhone )</td><tr>
<tr><th>Phone</th><td>$earlyAlert.createdBy.workPhone#end</td><tr>
<tr><th>Email</th><td>$earlyAlert.createdBy.primaryEmailAddress</td><tr>
</table>

<p>The Tutoring and Learning Center (Library: 512-4506) provides professional tutoring in the subject areas of English grammar and writing, basic math and study skills. The Center also provides additional quiet computer areas for students, online resources, and supplemental learning materials. Walk-ins are available during open hours. Call for schedule.</p>

<p>Tutorial Services (Library: 512-2792) provides free educational assistance for students who are enrolled in most 100 level courses (including DEV and some 200 level classes). Student tutors provide individual tutoring sessions by appointment.</p>

<p>The Writing Center (Library: 512-5106) provides a comfortable learning environment for classroom instruction and tutorial assistance for writing.</p>

<p>The Math Lab (Building 1, Room 315: 512-2286) provides tutoring and homework help for students in MAT classes. Walk-ins are available during open hours.</p>

<p>COPE is a unique series of workshops designed to help students Conquer some of the Obstacles that can Prevent the achievement of their Educational goals. A schedule of topics is available in 10-424 or online at http://www.sinclair.edu/stservices/cnsl/Cope/ Contact Anthony Webb at 512-2752 for handouts of past or future workshops.</p>

<p>Information on Dropping: Before withdrawing from any or all classes, consult an academic advisor. If you are using financial aid to pay for your tuition or books, contact the Financial Aid & Scholarships Office: Building 10, 3rd Floor, (937) 512-3000.</p>

<p>We value you as a student #if( $institutionName ) at $institutionName#end and want to support your success. If you have not been contacted by someone within a week, please feel free to speak with me.</p>

<p>Sincerely,</p>

<p>$earlyAlert.person.coach.firstName $earlyAlert.person.coach.lastName
<br />$earlyAlert.person.coach.title#if( $earlyAlert.person.coach.officeLocation )
<br />$earlyAlert.person.coach.officeLocation#end#if( $earlyAlert.person.coach.workPhone )
<br />$earlyAlert.person.coach.workPhone#end
<br />$earlyAlert.person.coach.primaryEmailAddress</p>

<p>Email generated by $!institutionName $!applicationTitle $!termToRepresentEarlyAlert</p>

<p>This is a system generated email. Please do not reply to this confirmation.</p>
</body></html>'
where id = 'b528c1ac-6104-435b-ae62-08eb4f8ef40e';

update message_template
set body = '<html><body>
<p><b>STUDENT $!termToRepresentEarlyAlert SYSTEM MESSAGE</b></p>
<table>
<tr><th>Student Name</th><td>$earlyAlert.person.firstName $earlyAlert.person.lastName</td></tr>
<tr><th>Student ID</th><td>$!earlyAlert.person.schoolId</td></tr>
<tr><th>Student Phone</th><td>$!earlyAlert.person.homePhone</td></tr>
<tr><th>Student Email</th><td>$earlyAlert.person.primaryEmailAddress</td></tr>
<tr><th>Address</th><td>#if( $earlyAlert.person.addressLine1 )$earlyAlert.person.addressLine1, #end#if( $earlyAlert.person.addressLine2 )$earlyAlert.person.addressLine2, #end#if( $earlyAlert.person.city )$earlyAlert.person.city, #end#if( $earlyAlert.person.state )$earlyAlert.person.state, #end$!earlyAlert.person.zipCode</td></tr>
<tr><th>In the class</th><td>$!earlyAlert.courseName</td></tr>
<tr><th>Instructor</th><td>$earlyAlert.createdBy.firstName $earlyAlert.createdBy.lastName</td></tr>
<tr><th>Campus</th><td>$!earlyAlert.campus.name</td></tr>
<tr><th>Instructor Office Location</th><td>$!earlyAlert.createdBy.officeLocation</td></tr>
<tr><th>Instructor Email</th><td>$earlyAlert.createdBy.primaryEmailAddress</td></tr>
<tr><th>Instructor Phone</th><td>$!earlyAlert.createdBy.workPhone</td></tr>
<tr><th>Advisor</th><td>$earlyAlert.person.coach.firstName $earlyAlert.person.coach.lastName</td></tr>
</table>
<p>Student has been identified by his/her instructor for the following reason:</ul>

<ul>
#foreach( $earlyAlertReason in $earlyAlert.earlyAlertReasonIds )
<li>$earlyAlertReason.name</li>
#end
</ul>

<p><b>The faculty suggestions are</b></p>
<ul>
#foreach( $earlyAlertSuggestion in $earlyAlert.earlyAlertSuggestionIds )
<li>$earlyAlertSuggestion.name</li>
#end
</ul>

#if( $earlyAlert.comment )
<p>
******************* INSTRUCTOR COMMENTS *******************
<br />
$earlyAlert.comment
<br />
******************* INSTRUCTOR COMMENTS *******************
</p>
#end


<p>Email generated by $!institutionName $!applicationTitle $!termToRepresentEarlyAlert</p>

<p>This is a system generated email. Please do not reply to this confirmation.</p>
</body></html>'
where id = 'b528c1ac-6104-435b-ae62-09eb5f8ef55f';

update message_template
set body = '<html><body>
<p><b>STUDENT $!termToRepresentEarlyAlert SYSTEM MESSAGE</b></p>

<p>This email is in response to an early alert notice initiated on $earlyAlert.createdDate for the following student:</p>

<table>
<tr><th>Student Name</th><td>$earlyAlert.person.firstName $earlyAlert.person.lastName</td></tr>
<tr><th>Student ID</th><td>$!earlyAlert.person.schoolId</td></tr>
<tr><th>In the class</th><td>$!earlyAlert.courseName</td></tr>
<tr><th>Instructor</th><td>$earlyAlert.createdBy.firstName $earlyAlert.createdBy.lastName</td></tr>
<tr><th>Advisor(s)</th><td>$earlyAlert.person.coach.firstName $earlyAlert.person.coach.lastName</td></tr>
</table>

<p>This incident was addressed and CLOSED on $earlyAlertResponse.closedDate.  The final outcome for this incident was:</p>

<p>$!earlyAlertResponse.earlyAlertOutcome.name</p>

#if( $earlyAlertResponse.earlyAlertOutcomeOtherDescription )
<p>$earlyAlertResponse.earlyAlertOutcomeOtherDescription</p>
#end

<p>The student has been referred by his/her counselor to the following departments or services based upon early alert status:</p>
<ul>
#foreach( $earlyAlertReferral in $earlyAlertResponse.earlyAlertReferralIds )
<li>$earlyAlertReferral.name</li>
#end
</ul>

#if( $earlyAlertResponse.comment )
<p>******************* INSTRUCTOR COMMENTS *******************
<br />
$earlyAlertResponse.comment
<br />
******************* INSTRUCTOR COMMENTS *******************</p>
#end

<p>Email generated by $!institutionName $!applicationTitle $!termToRepresentEarlyAlert</p>
</body></html>'
where id = 'b528c1ac-6104-435b-ae62-09fb5f9ef680';

			]]>
		</sql>
		<rollback>
			<comment>Not rolling back to plain text</comment>
		</rollback>
	</changeSet>

	<changeSet id="Remove unused message template" author="daniel.bower">
		<delete tableName="message_template">
			<where>id = '7c945020-86b0-11e1-849a-0026b9e7ff4c'</where>
		</delete>
		<rollback>
			<comment>Not restoring unused message template</comment>
		</rollback>
	</changeSet>

	<changeSet id="correct message template errors" author="daniel.bower">
		<sql>
<![CDATA[
update message_template
set body = '${task.person.firstName},<br/>An Action Item identified through the Sinclair Community College Resources application needs your attention.  Please login to your account at https://resources.sinclair.edu to review and complete the assigned item.<br/><br/>The following item is due for review:<br/>Challenge: ${task.challenge.name}<br/>Referral: ${task.challengeReferral.name}<br/>Due Date: ${dueDateFormatted}'
where id = 'AEC07252-1FF0-479D-A2EF-C0E017E1C05D';

update message_template
set body = '${task.person.firstName},<br/>An Action Item identified through the Sinclair Community College Resources application needs your attention.  Please login to your account at https://resources.sinclair.edu to review and complete the assigned item.<br/><br/>The following item is due for review:<br/>Name: ${task.name}<br/>Description: ${task.description}<br/>Due Date: ${dueDateFormatted}'
where id = '31CF8D8D-2BC9-44E0-AAD1-D8BA43530BB0';

update message_template
set subject = 'Action plan for ${fullName}'
where id = '5D183F35-023D-40EA-B8D9-66FBE190FFFB';

update message_template
set body = '<html><body><p>Hello ${fullName}!</p><p>Your Coach or Advisor has asked that you complete a Task online, the Student Intake form.  ${description}  The form is a series of questions that should only take a few minutes to complete.  The information collected will assist us in providing you with the best services and advice that we can.</p> <p>Please login with your college username and password at the following URL:  <a href="https://resources.sinclair.edu">https://resources.sinclair.edu</a></p><p>The Student Intake link will appear in the Task list on the right side of the screen.</p><p>Please complete this task by ${dueDateFormatted}</p><p>Thank you for your time and cooperation.  We look forward to providing you great service!</p><p>-Sinclair Team</p><p>If you have questions, please contact your Coach or Advisor directly. This is an automated message, please do not use the reply option.</p></body></html>'
where id = '9D3CE5B1-E27D-40C8-8F45-ABCB1BCCF3B0';
]]>
		</sql>

		<rollback>
			<comment>Ignore rollback - fixes typos</comment>
		</rollback>
	</changeSet>


	<changeSet id="usernames must be unique" author="daniel.bower">
		<addUniqueConstraint tableName="person"
			columnNames="username" constraintName="unique_person_username" />
	</changeSet>

	<!-- changeSet id="Additional Legacy MessageTemplates 2" author="daniel.bower"> 
		<insert tableName="message_template"> <column name="id" value="919F6FF5-8F22-4684-8729-D615206A2644" 
		/> <column name="name" value="Task Auto Created Email" /> <column name="description" 
		value="Task Auto Created Email" /> <column name="subject" value="" /> <column 
		name="body" value="EMPTY" /> <column name="created_date" valueDate="2012-05-17T10:00:00" 
		/> <column name="modified_date" valueDate="2012-05-17T10:00:00" /> <column 
		name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" /> <column 
		name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" /> <column 
		name="object_status" value="1" /> </insert> <sql> <![CDATA[ update message_template 
		set body = '' where id = '919F6FF5-8F22-4684-8729-D615206A2644'; ]]> </sql> 
		<rollback> <delete tableName="message_template"> <where>id = '919F6FF5-8F22-4684-8729-D615206A2644'</where> 
		</delete> </rollback> </changeSet -->


	<changeSet author='jon.adams' id='Add program_status table'>
		<createTable tableName="program_status">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="${nvarchar.type}(80)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="text">
				<constraints nullable="true" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="program_status_created_by_person_id" references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="program_status_modified_by_person_id" references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="program_status_change_reason_required" type="boolean"
				defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</createTable>

		<sql>grant all on program_status to ssp</sql>
		<rollback>
			<dropTable tableName="program_status" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="create reference data - program_status"
		author="jon.adams">
		<insert tableName="program_status">
			<column name="id" value="B2D12527-5056-A51A-8054-113116BAAB88" />
			<column name="name" value="Active" />
			<column name="description" value="Student is active in SSP" />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<insert tableName="program_status">
			<column name="id" value="B2D125A4-5056-A51A-8042-D50B8EFF0DF1" />
			<column name="name" value="Inactive" />
			<column name="description" value="Student is inactive in SSP" />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<insert tableName="program_status">
			<column name="id" value="B2D125C3-5056-A51A-8004-F1DBABDE80C2" />
			<column name="name" value="Non-participating" />
			<column name="description" value="Student is not participating in ILP program" />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<insert tableName="program_status">
			<column name="id" value="B2D125E3-5056-A51A-800F-6891BC7D1DDC" />
			<column name="name" value="Transitioned" />
			<column name="description" value="Student has completed the ILP Program." />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<insert tableName="program_status">
			<column name="id" value="B2D125F2-5056-A51A-8061-5E041339311D" />
			<column name="name" value="Completed" />
			<column name="description" value="Student has completed CAP assessment." />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<insert tableName="program_status">
			<column name="id" value="B2D12640-5056-A51A-80CC-91264965731A" />
			<column name="name" value="No-Show" />
			<column name="description" value="Student did not show up for an appointment" />
			<column name="created_date" valueDate="2012-05-18T14:00:00" />
			<column name="modified_date" valueDate="2012-05-18T14:00:00" />
			<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
			<column name="object_status" value="1" />
			<column name="program_status_change_reason_required" value="0" />
		</insert>
		<rollback>
			<delete tableName="program_status">
				<where>id='B2D12527-5056-A51A-8054-113116BAAB88'</where>
			</delete>
			<delete tableName="program_status">
				<where>id='B2D125A4-5056-A51A-8042-D50B8EFF0DF1'</where>
			</delete>
			<delete tableName="program_status">
				<where>id='B2D125C3-5056-A51A-8004-F1DBABDE80C2'</where>
			</delete>
			<delete tableName="program_status">
				<where>id='B2D125E3-5056-A51A-800F-6891BC7D1DDC'</where>
			</delete>
			<delete tableName="program_status">
				<where>id='B2D125F2-5056-A51A-8061-5E041339311D'</where>
			</delete>
			<delete tableName="program_status">
				<where>id='B2D12640-5056-A51A-80CC-91264965731A'</where>
			</delete>
		</rollback>
	</changeSet>

	<changeSet author='jon.adams' id='Add person_program_status table'>
		<createTable tableName="person_program_status">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_program_status_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_program_status_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="program_status_id" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_program_status_program_status_id"
					references="program_status(id)" />
			</column>
			<column name="program_status_change_reason_id" type="uuid">
				<constraints nullable="true"
					foreignKeyName="person_program_status_change_reason_program_status_id"
					references="program_status_change_reason(id)" />
			</column>
			<column name="person_id" type="uuid">
				<constraints nullable="false" foreignKeyName="person_program_status_person_id"
					references="person(id)" />
			</column>
			<column name="effective_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="expiration_date" type="datetime">
				<constraints nullable="true" />
			</column>
		</createTable>

		<sql>grant all on person_program_status to ssp</sql>
		<rollback>
			<dropTable tableName="person_program_status" />
		</rollback>

		<!-- Theres a different assumption in the liquibase handling of timezones 
			on postgres. Specifying "Without" timezone -->
		<modifySql dbms="postgresql">
			<replace replace="WITH TIME ZONE" with="WITHOUT TIME ZONE" />
		</modifySql>

	</changeSet>

	<changeSet id="Add role to ConfidentialityLevel" author="daniel.bower">
		<addColumn tableName="confidentiality_level">
			<column name="permission" type="${nvarchar.type}(36)">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_ACADEMIC_RESOURCE_CENTER" />
			<where>id='b2d077a7-4055-0510-7957-4a09f93a0346'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_STAFF" />
			<where>id='b2d078b8-5056-a51a-8057-4a09f93a0347'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_MANAGER" />
			<where>id='b2d07906-5056-a51a-80fd-9d19f636e501'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_DISABILITY" />
			<where>id='b2d07915-5056-a51a-80ce-334eca0e0a10'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_COUNSELING_SERVICES" />
			<where>id='b2d07935-5056-a51a-80db-caa0dadd3f2e'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_INDIVIDUALIZED_LEARNING_PLAN" />
			<where>id='b2d07944-5056-a51a-8047-654512d4d083'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_ENGLISH_SECOND_LANGUAGE" />
			<where>id='b2d07964-5056-a51a-800a-a95d3bb3c4d1'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_DISPLACED_WORKERS" />
			<where>id='b2d07964-5157-a51a-800a-a95d3bb3c4e3'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_EARLY_ALERT" />
			<where>id='b2d07964-5157-a51a-800a-a95d3bb3c4f4'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_FAST_FORWARD" />
			<where>id='b2d07964-5157-a51a-800a-a95d3bb3c505'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="DATA_EVERYONE" />
			<where>id='b3d077a7-4055-0510-7967-4a09f93a0357'</where>
		</update>

		<update tableName="confidentiality_level">
			<column name="permission" value="UNKNOWN" />
			<where>permission is NULL</where>
		</update>

		<addNotNullConstraint tableName="confidentiality_level"
			columnName="permission" columnDataType="${nvarchar.type}(36)" />

		<rollback>
			<dropColumn tableName="confidentiality_level" columnName="permission" />
		</rollback>
	</changeSet>

</databaseChangeLog>