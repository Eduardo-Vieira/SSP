<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="nvarchar.type" value="character varying" dbms="postgresql" />
	<property name="nvarchar.type" value="nvarchar" dbms="mssql" />

	<changeSet id="not null constraint to person.school_id"
		author="jon.adams">
		<update tableName="person">
			<column name="school_id">userid_3</column>
			<where>id = '46DA4CB4-6EB4-4B91-8E39-8F9FA4D85552'</where>
		</update>
		<update tableName="person">
			<column name="school_id">userid_4</column>
			<where>id = '58BA5EE3-734E-4AE9-B9C5-943774B4DE41'</where>
		</update>

		<addNotNullConstraint tableName="person"
			columnName="school_id" columnDataType="${nvarchar.type}(50)" />
		<addUniqueConstraint tableName="person"
			columnNames="school_id" constraintName="uq_person_school_id" />
		<rollback>
			<dropNotNullConstraint tableName="person"
				columnName="school_id" columnDataType="${nvarchar.type}(50)" />
			<dropUniqueConstraint tableName="person"
				constraintName="uq_person_school_id" />
		</rollback>
	</changeSet>

	<changeSet id="Remove program status Completed item" author="jon.adams">
		<delete tableName="program_status">
			<where>id = 'b2d125f2-5056-a51a-8061-5e041339311d'</where>
		</delete>
		<rollback>
			<insert tableName="program_status">
				<column name="id" value="B2D125F2-5056-A51A-8061-5E041339311D" />
				<column name="name" value="Completed" />
				<column name="description" value="Student has completed CAP assessment." />
				<column name="created_date" valueDate="2012-05-18T14:00:00" />
				<column name="modified_date" valueDate="2012-05-18T14:00:00" />
				<column name="created_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
				<column name="modified_by" value="58ba5ee3-734e-4ae9-b9c5-943774b4de41" />
				<column name="object_status" value="1" />
				<column name="program_status_change_reason_required" value="0" />
			</insert>
		</rollback>
	</changeSet>

	<changeSet author='jon.adams' id='Add missing field to early_alert table'>
		<addColumn tableName="early_alert">
			<column name="early_alert_suggestion_other_description" type="text">
				<constraints nullable="true" />
			</column>
		</addColumn>
	</changeSet>

</databaseChangeLog>