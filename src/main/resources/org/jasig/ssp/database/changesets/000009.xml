<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="nvarchar.type" value="character varying" dbms="postgresql" />
	<property name="nvarchar.type" value="nvarchar" dbms="mssql" />

	<changeSet id="drop userid column" author="daniel.bower">
		<dropColumn tableName="person" columnName="user_id" />

		<rollback>
			<addColumn tableName="person">
				<column name="user_id" type="${nvarchar.type}(25)">
					<constraints nullable="true" />
				</column>
			</addColumn>
		</rollback>
	</changeSet>

	<changeSet id="add index to username" author="daniel.bower">
		<createIndex tableName="person" indexName="idx_person_username">
			<column name="username" />
		</createIndex>

		<rollback>
			<dropIndex tableName="person" indexName="idx_person_username" />
		</rollback>
	</changeSet>

	<changeSet id="Set early_alert.campus_id to not nullable"
		author="alexander.leader">
		<addNotNullConstraint tableName="early_alert"
			columnName="campus_id" columnDataType="uuid" />
		<rollback>
			<dropNotNullConstraint tableName="early_alert"
				columnName="campus_id" columnDataType="uuid" />
		</rollback>
	</changeSet>

	<changeSet id="Add career questions to PersonEducationGoal"
		author="alexander.leader">
		<addColumn tableName="person_education_goal">
			<column name="planned_major" type="${nvarchar.type}(50)">
				<constraints nullable="true" />
			</column>
		</addColumn>
		<addColumn tableName="person_education_goal">
			<column name="career_decided" type="boolean" />
		</addColumn>
		<addColumn tableName="person_education_goal">
			<column name="how_sure_about_occupation" type="int">
				<constraints nullable="true" />
			</column>
		</addColumn>
		<addColumn tableName="person_education_goal">
			<column name="confident_in_abilities" type="boolean" />
		</addColumn>
		<addColumn tableName="person_education_goal">
			<column name="additional_academic_program_information_needed"
				type="boolean" />
		</addColumn>
		<rollback>
			<dropColumn tableName="person_education_goal" columnName="planned_major" />
			<dropColumn tableName="person_education_goal" columnName="career_decided" />
			<dropColumn tableName="person_education_goal" columnName="how_sure_about_occupation" />
			<dropColumn tableName="person_education_goal" columnName="confident_in_abilities" />
			<dropColumn tableName="person_education_goal"
				columnName="additional_academic_program_information_needed" />
		</rollback>
	</changeSet>

	<changeSet id="middle initial to middle name" author="daniel.bower">
		<renameColumn tableName="person" oldColumnName="middle_initial"
			newColumnName="middle_name" />
		<modifyDataType tableName="person" columnName="middle_name"
			newDataType="${nvarchar.type}(50)" />

		<rollback>
			<modifyDataType tableName="person" columnName="middle_name"
				newDataType="char(1)" />
			<renameColumn tableName="person" oldColumnName="middle_name"
				newColumnName="middle_initial" />
		</rollback>
	</changeSet>

	<changeSet id="actual start and balance owed to person demographics"
		author="daniel.bower">
		<modifyDataType tableName="person_demographics"
			columnName="anticipated_start_term" newDataType="${nvarchar.type}(20)" />

		<dropColumn tableName="person_demographics" columnName="anticipated_start_year" />

		<addColumn tableName="person_demographics">
			<column name="anticipated_start_year" type="integer">
				<constraints nullable="true" />
			</column>
			<column name="actual_start_year" type="integer">
				<constraints nullable="true" />
			</column>
			<column name="actual_start_term" type="${nvarchar.type}(20)">
				<constraints nullable="true" />
			</column>
			<column name="balance_owed" type="decimal(9,2)">
				<constraints nullable="true" />
			</column>
		</addColumn>

		<rollback>
			<addColumn tableName="person_demographics">
				<column name="anticipated_start_year" type="${nvarchar.type}(4)">
					<constraints nullable="true" />
				</column>
			</addColumn>
			<modifyDataType tableName="person_demographics"
				columnName="anticipated_start_term" newDataType="${nvarchar.type}(25)" />
			<dropColumn tableName="person_demographics" columnName="actual_start_year" />
			<dropColumn tableName="person_demographics" columnName="actual_start_term" />
			<dropColumn tableName="person_demographics" columnName="balance_owed" />
		</rollback>
	</changeSet>

	<changeSet id="allow nulls to Track in Journal entries"
		author="jon.adams">
		<dropNotNullConstraint tableName="journal_entry"
			columnName="journal_track_id" columnDataType="uuid" />
	</changeSet>

	<changeSet id="add person_staff_details" author="jon.adams">
		<createTable tableName="person_staff_details">
			<column name="id" type="uuid">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="created_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="modified_date" type="datetime" />
			<column name="created_by" type="uuid">
				<constraints nullable="false"
					foreignKeyName="person_staff_details_created_by_person_id"
					references="person(id)" />
			</column>
			<column name="modified_by" type="uuid">
				<constraints nullable="true"
					foreignKeyName="person_staff_details_modified_by_person_id"
					references="person(id)" />
			</column>
			<column name="object_status" type="int">
				<constraints nullable="false" />
			</column>
			<column name="office_location" type="${nvarchar.type}(50)" />
			<column name="office_hours" type="${nvarchar.type}(50)" />
			<column name="department_name" type="${nvarchar.type}(100)" />
		</createTable>
		<sql>grant all on person_staff_details to ssp</sql>
		<addColumn tableName="person">
			<column name="person_staff_details_id" type="uuid">
				<constraints nullable="true" foreignKeyName="person_person_staff_details_id"
					references="person_staff_details(id)" />
			</column>
		</addColumn>
	</changeSet>

</databaseChangeLog>