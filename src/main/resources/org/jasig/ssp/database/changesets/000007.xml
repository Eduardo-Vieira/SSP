<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext 
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="nvarchar.type" value="character varying" dbms="postgresql" />
	<property name="nvarchar.type" value="nvarchar" dbms="mssql" />

	<changeSet id="Add unique constraint to permission" author="daniel.bower">
		<addUniqueConstraint tableName="confidentiality_level"
			columnNames="permission" />
	</changeSet>

	<changeSet id="Require ConfLevel On Task" author="daniel.bower">
		<update tableName="task">
			<column name="confidentiality_level_id">b3d077a7-4055-0510-7967-4a09f93a0357</column>
			<where>confidentiality_level_id is null</where>
		</update>
		<addNotNullConstraint tableName="task"
			columnName="confidentiality_level_id" columnDataType="uuid" />
		<!-- Auto rollback support -->
	</changeSet>


	<changeSet id="Add goals to action plan MessageTemplate"
		author="jon.adams">
		<update tableName="message_template">
			<column name="modified_date" valueDate="2012-06-28T18:00:00" />
			<column name="body"><![CDATA[<html>
<body>Dear ${fullName},<br/>
<br/>
As a result of completing the self help guide questionnaire(s) you have 
identified the following resource information as being imperative to your 
success.&nbsp;&nbsp;Below you will find the solutions you felt offered the best 
path to your success.<br/>
<br/>
<br/>
#foreach($taskTO in $taskTOs)<b>Resource:</b>&nbsp;${taskTO.name}<br/><b>Description:</b>&nbsp;${taskTO.description}<br/><br/>#end <br/>
#foreach($goalTO in $goalTOs)<b>Resource:</b>&nbsp;${goalTO.name}<br/><b>Description:</b>&nbsp;${goalTO.description}<br/><br/>#end <br/>
Should you have any questions concerning the resource information listed please contact the resource in question or the counseling staff at your institution.<br/>
<br/>
Thank you.</body></html>]]>
			</column>
			<where>
				id = '5D183F35-023D-40EA-B8D9-66FBE190FFFB'
			</where>
		</update>
	</changeSet>

</databaseChangeLog>